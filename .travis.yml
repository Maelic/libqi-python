language: python

dist: focal
python:
  - "3.5"
  - "3.6"
  - "3.7"
  - "3.8"

jobs:
  include:
      - name: "Python 3.8"
        os: osx
        osx_image: xcode10.1
        language: shell
        addons:
          homebrew:
            packages:
              - openssl@1.1
              - python@3.8
            update: true
        env:
          - CMAKE_ARGS="-DOPENSSL_ROOT_DIR=/usr/local/opt/openssl@1.1"

install:
  - wget -q http://sourceforge.net/projects/boost/files/boost/1.64.0/boost_1_64_0.tar.gz/download -O boost_1_64_0.tar.gz
  - tar xzf boost_1_64_0.tar.gz
  - pushd boost_1_64_0 &&
    ./bootstrap.sh --prefix=$HOME/opt/boost_1_64_0 --with-libraries=atomic,date_time,thread,chrono,filesystem,locale,regex,program_options,random &&
    ./b2 -d0 link=shared threading=multi variant=release &&
    sudo ./b2 -d0 install &&
    popd
  - python3 --version
  - python3 -m pip install -U pip pytest pytest-timeout
  - python3 -m pip install cmake>=3.16 ninja qibuild>=3.15 scikit-build

script:
  - python3 setup.py bdist_wheel -- $CMAKE_ARGS -DBOOST_ROOT=$HOME/opt/boost_1_64_0
  - pushd _skbuild/*/cmake-build &&
    ctest --output-on-failure &&
    popd

#deploy:
#  provider: releases
#  api_key: "GITHUB OAUTH TOKEN"
#  file: "FILE TO UPLOAD"
#  skip_cleanup: true
#  draft: true
#  overwrite: true
